<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Babel | 前端小册</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="个人知识笔记">
    <meta name="keywords" content="vuepress,theme,blog,vdoing">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.6e60c68c.css" as="style"><link rel="preload" href="/assets/js/app.c3eaab60.js" as="script"><link rel="preload" href="/assets/js/2.0d541d74.js" as="script"><link rel="preload" href="/assets/js/11.fdd192f9.js" as="script"><link rel="prefetch" href="/assets/js/10.945953ec.js"><link rel="prefetch" href="/assets/js/12.f930e6cf.js"><link rel="prefetch" href="/assets/js/13.83f7fdb4.js"><link rel="prefetch" href="/assets/js/14.d1f6a6d2.js"><link rel="prefetch" href="/assets/js/15.a3fc3a4c.js"><link rel="prefetch" href="/assets/js/16.1af45818.js"><link rel="prefetch" href="/assets/js/17.34452123.js"><link rel="prefetch" href="/assets/js/18.c2709a46.js"><link rel="prefetch" href="/assets/js/19.eda02219.js"><link rel="prefetch" href="/assets/js/20.21e22d86.js"><link rel="prefetch" href="/assets/js/21.0a21f463.js"><link rel="prefetch" href="/assets/js/22.ed465c56.js"><link rel="prefetch" href="/assets/js/23.92728309.js"><link rel="prefetch" href="/assets/js/24.a934b340.js"><link rel="prefetch" href="/assets/js/25.f19a7630.js"><link rel="prefetch" href="/assets/js/3.c3295fe2.js"><link rel="prefetch" href="/assets/js/4.eec9b412.js"><link rel="prefetch" href="/assets/js/5.20cfe6af.js"><link rel="prefetch" href="/assets/js/6.3fdbcc80.js"><link rel="prefetch" href="/assets/js/7.7429f292.js"><link rel="prefetch" href="/assets/js/8.8bafbea7.js"><link rel="prefetch" href="/assets/js/9.a3529f32.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6e60c68c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200409124835.png" alt="前端小册" class="logo"> <span class="site-name can-hide">前端小册</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML" class="dropdown-title"><!----> <span class="title" style="display:;">HTML</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/925544/" class="nav-link">基础语法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><!----> <span class="title" style="display:;">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/1687ff/" class="nav-link">基础语法</a></li></ul></div></div><div class="nav-item"><a href="/pages/db78e2/" class="nav-link">JS</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工具" class="dropdown-title"><!----> <span class="title" style="display:;">前端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/5d396b/" class="nav-link">前端需要掌握的命令行</a></li><li class="dropdown-item"><!----> <a href="/pages/52d5c3/" class="nav-link">git扫盲</a></li><li class="dropdown-item"><!----> <a href="/pages/b0b059/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Babel</a></li><li class="dropdown-item"><!----> <a href="/pages/631196/" class="nav-link">Rollup</a></li></ul></div></div><div class="nav-item"><a href="/pages/b0b059/.html" class="nav-link">Node</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><!----> <span class="title" style="display:;">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/c7313b/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/eb039d/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><a href="/pages/19ad2a/" class="nav-link">数据结构与算法</a></div> <a href="https://github.com/erdang/erdang.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="HTML" class="dropdown-title"><!----> <span class="title" style="display:;">HTML</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/925544/" class="nav-link">基础语法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CSS" class="dropdown-title"><!----> <span class="title" style="display:;">CSS</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/1687ff/" class="nav-link">基础语法</a></li></ul></div></div><div class="nav-item"><a href="/pages/db78e2/" class="nav-link">JS</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端工具" class="dropdown-title"><!----> <span class="title" style="display:;">前端工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/5d396b/" class="nav-link">前端需要掌握的命令行</a></li><li class="dropdown-item"><!----> <a href="/pages/52d5c3/" class="nav-link">git扫盲</a></li><li class="dropdown-item"><!----> <a href="/pages/b0b059/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Babel</a></li><li class="dropdown-item"><!----> <a href="/pages/631196/" class="nav-link">Rollup</a></li></ul></div></div><div class="nav-item"><a href="/pages/b0b059/.html" class="nav-link">Node</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><!----> <span class="title" style="display:;">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/c7313b/" class="nav-link">React</a></li><li class="dropdown-item"><!----> <a href="/pages/eb039d/" class="nav-link">Vue</a></li></ul></div></div><div class="nav-item"><a href="/pages/19ad2a/" class="nav-link">数据结构与算法</a></div> <a href="https://github.com/erdang/erdang.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>git</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/52d5c3/" class="sidebar-link">一篇git扫盲</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>命令行</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/5d396b/" class="sidebar-link">前端应该掌握的命令行</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Babel</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b0b059/" aria-current="page" class="active sidebar-link">Babel</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/b0b059/#babel" class="sidebar-link">Babel</a></li><li class="sidebar-sub-header"><a href="/pages/b0b059/#关于-babel-版本" class="sidebar-link">关于 Babel 版本</a></li><li class="sidebar-sub-header"><a href="/pages/b0b059/#babel-配置文件" class="sidebar-link">Babel 配置文件</a></li><li class="sidebar-sub-header"><a href="/pages/b0b059/#插件与预设" class="sidebar-link">插件与预设</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/b0b059/#preset-预设的选择" class="sidebar-link">preset 预设的选择</a></li><li class="sidebar-sub-header"><a href="/pages/b0b059/#plugin-插件的选择" class="sidebar-link">plugin 插件的选择</a></li><li class="sidebar-sub-header"><a href="/pages/b0b059/#babel-polyfill" class="sidebar-link">@babel/polyfill</a></li></ul></li></ul></li><li><a href="/pages/f05617/" class="sidebar-link">Babel原理</a></li><li><a href="/pages/50e319/" class="sidebar-link">AST</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Rollup</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/631196/" class="sidebar-link">rollup前置学习基础</a></li><li><a href="/pages/56d8db/" class="sidebar-link">rollup</a></li><li><a href="/pages/1e2662/" class="sidebar-link">rollup搭建工具库</a></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><span data-v-1cd794fe>前端工具</span></li> <li data-v-1cd794fe><span data-v-1cd794fe>Babel</span></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/erdang" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Er Dang</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2022-04-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          Babel
        </h1>  <div class="theme-vdoing-content content__default"><h2 id="babel"><a href="#babel" class="header-anchor">#</a> Babel</h2> <p><code>Babel</code> 是一个工具链，主要用于将采用 <code>ECMAScript 2015+</code> 语法编写的代码转换为向后兼容的 <code>JavaScript 语法</code>，以便能够运行在当前和旧版本的浏览器或其他环境中。</p> <p>我们一般用 Babel 做下面几件事：</p> <ul><li>语法转换（<code>es-higher</code> -&gt; <code>es-lower</code>）;</li> <li>通过 <code>Polyfill</code> 处理在目标环境无法转换的特性（通过 <code>core-js</code> 实现）;</li> <li>源码转换（<code>codemods</code>、<code>jscodeshift</code>）;</li> <li>静态分析（<code>lint</code>、根据注释生成 <code>API</code> 文档等）;</li></ul> <h2 id="关于-babel-版本"><a href="#关于-babel-版本" class="header-anchor">#</a> 关于 Babel 版本</h2> <p>目前，前端开发领域使用的 Babel 版本主要的 Babel6 和 Babel7 这两个版本。</p> <p>Babel 是一个工具集，而这个工具集是围绕@babel/core 这个核心 npm 包构成的。每次@babel/core 发布新版本的时候，整个工具集的其它 npm 包也都会跟着升级到与@babel/core 相同的版本号，即使它们的代码可能一行都没有改变。</p> <p>Babel7 的 npm 包都是放在 babel 域下的，即在安装 npm 包的时候，我们是安装@babel/这种方式，例如@babel/cli、@babel/core 等。而在 Babel6，我们安装的包名是 babel-cli，babel-core 等。其实它们本质是一样的，都是 Babel 官方的 cli 命令行工具和 core 核心包，而且功能是一样的，只是名称版本变化了一下而已。在平时开发和学习的过程中，碰到'@babel/'和'babel-'应该下意识认识到他俩原本是一个包，只是版本不一样而已。</p> <h2 id="babel-配置文件"><a href="#babel-配置文件" class="header-anchor">#</a> Babel 配置文件</h2> <p>Babel 的配置文件是 Babel 执行时默认会在当前目录寻找的文件，主要有.babelrc，.babelrc.js，babel.config.js 和 package.json。它们的配置项都是相同，作用也是一样的，只需要选择其中一种。</p> <p>对于.babelrc，它的配置是这样子</p> <div class="language- extra-class"><pre><code>{
    &quot;presets&quot;: [&quot;es2015&quot;, &quot;react&quot;],
    &quot;plugins&quot;: [&quot;transform-decorators-legacy&quot;, &quot;transform-class-properties&quot;]
}
</code></pre></div><p>对于 babel.config.js 和.babelrc.js，它的配置是一样的，通过 module.exports 输出配置项</p> <div class="language- extra-class"><pre><code>module.exports = {
    &quot;presets&quot;: [&quot;es2015&quot;, &quot;react&quot;],
    &quot;plugins&quot;: [&quot;transform-decorators-legacy&quot;, &quot;transform-class-properties&quot;]
}
</code></pre></div><p>对于 package.json，就是在 package.json 中增加一个 babel 属性和值，它的配置是这样子</p> <div class="language- extra-class"><pre><code>{
    &quot;name&quot;: &quot;demo&quot;,
    &quot;version&quot;: &quot;1.0.0&quot;,
    &quot;description&quot;: &quot;&quot;,
    &quot;main&quot;: &quot;index.js&quot;,
    &quot;scripts&quot;: {
        &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
    },
    &quot;author&quot;: &quot;&quot;,
    &quot;babel&quot;: {
        &quot;presets&quot;: [&quot;es2015&quot;, &quot;react&quot;],
        &quot;plugins&quot;: [&quot;transform-decorators-legacy&quot;, &quot;transform-class-properties&quot;]
    }
}
</code></pre></div><p>在 webpack 配置文件中，我们把 babel-loader 添加到 module 的 loaders 列表中：</p> <div class="language- extra-class"><pre><code>module: {
    rules: [
    {
        test: /\.js$/,
        exclude: /(node_modules|bower_components)/,
        use: {
        loader: 'babel-loader',
        options: {
            presets: ['@babel/preset-env']
        }
        }
    }
    ]
}
</code></pre></div><p>在这里，我们通过 options 属性给 babel-loader 传递预设和插件等 Babel 配置项。我们也可以省略这个 options，这个时候 babel-loader 会去读取默认的 Babel 配置文件，也就是.babelrc，.babelrc.js，babel.config.js 等。在现在的前端开发中，建议通过配置文件来传递这些配置项。</p> <h2 id="插件与预设"><a href="#插件与预设" class="header-anchor">#</a> 插件与预设</h2> <p>plugin 代表插件，preset 代表预设，它们分别放在 plugins 和 presets，每个插件或预设都是一个 npm 包。</p> <p>plugins 插件数组和 presets 预设数组是有顺序要求的。如果两个插件或预设都要处理同一个代码片段，那么会根据插件和预设的顺序来执行。规则如下</p> <ul><li>插件比预设先执行</li> <li>插件执行顺序是插件数组从前向后执行</li> <li>预设执行顺序是预设数组从后向前执行</li></ul> <h3 id="preset-预设的选择"><a href="#preset-预设的选择" class="header-anchor">#</a> preset 预设的选择</h3> <p>在 Babel6 的时代 ,很复杂,一言难尽 ,现在只需一个<code>@babel/preset-env</code>就可以了</p> <p>在实际开发过程中，除了使用@babel/preset-env 对标准的 ES6 语法转换，我们可能还需要类型检查和 react 等预设对特定语法转换。这里有三个官方预设可以使用：</p> <div class="language- extra-class"><pre><code>* @babel/preset-flow
* @babel/preset-react
* @babel/preset-typescript
</code></pre></div><p>总结起来，Babel 官方的 preset，我们实际可能会用到的其实就只有 4 个：</p> <div class="language- extra-class"><pre><code>* @babel/preset-env
* @babel/preset-flow
* @babel/preset-react
* @babel/preset-typescript
</code></pre></div><p>一个普通的 vue 工程，Babel 官方的 preset 只需要配一个&quot;@babel/preset-env&quot;就可以了</p> <h4 id="babel-preset-env"><a href="#babel-preset-env" class="header-anchor">#</a> @babel/preset-env</h4> <p>在 Babel6 时代，这个预设名字是 babel-preset-env，在 Babel7 之后，改成@babel/preset-env。除了进行语法转换，该预设还可以通过设置参数项进行针对性语法转换以及 polyfill 的按需引入</p> <p>在使用它之前，需要先安装</p> <div class="language- extra-class"><pre><code> npm install --save-dev @babel/core @babel/cli @babel/preset-env
</code></pre></div><p>以 babel.config.js 为例,对于 preset，当我们不需要对其设置参数的时候</p> <div class="language- extra-class"><pre><code>module.exports = {
    presets: [&quot;@babel/preset-env&quot;],
    plugins: []
}
</code></pre></div><p><strong>targets</strong> 该参数项可以取值为字符串、字符串数组或对象，默认{},targets &gt; browserslist(都没设置 全部 es6=&gt;es5)</p> <div class="language- extra-class"><pre><code>module.exports = {
    presets: [[&quot;@babel/env&quot;, {
    targets: {
        &quot;chrome&quot;: &quot;58&quot;,
        &quot;ie&quot;: &quot;11&quot;
    },
    &quot;useBuiltIns&quot;: &quot;usage&quot;,
    &quot;corejs&quot;: 3
    }]],
    plugins: []
}
</code></pre></div><p><strong>useBuiltIns</strong> 默认值 false</p> <div class="language- extra-class"><pre><code>    usage：每个文件引用使用到的特性；
    false：不引入,如果 引入 @babel/polyfill 则全引入
    entry：全部引入,需要 入口文件
           import &quot;core-js/stable&quot;;
           import &quot;regenerator-runtime/runtime&quot;;
</code></pre></div><p><strong>corejs</strong> 默认值 2,只有 useBuiltIns 设置为'usage'或'entry'时，才会生效
2 对应 core-js@2 ,3 对应 core-js@3(目前多用的是 3)</p> <p>ps:Browserslist 叫做目标环境配置表，除了写在 package.json 里，也可以单独写在工程目录下.browserslistrc 文件里。我们用 browserslist 来指定代码最终要运行在哪些浏览器或 node.js 环境。Autoprefixer、postcss 等就可以根据我们的 browserslist，来自动判断是否要增加 CSS 前缀（例如'-webkit-'）。我们的 Babel 也可以使用 browserslist，如果你使用了@babel/preset-env 这个预设，此时 Babel 就会读取 browserslist 的配置。</p> <p>如果我们的@babel/preset-env 不设置任何参数，Babel 就会完全根据 browserslist 的配置来做语法转换。如果没有 browserslist，那么 Babel 就会把所有 ES6 的语法转换成 ES5 版本。</p> <h4 id="babel6-到-babel7-的升级"><a href="#babel6-到-babel7-的升级" class="header-anchor">#</a> Babel6 到 Babel7 的升级</h4> <ul><li><p>废弃了 stage-x 和 es20xx 的 preset，改成 preset-env 和 plugin-proposal-xx；这样能更好地控制需要支持的特性；</p></li> <li><p><code>preset-env</code> 依赖 <code>browserslist</code>, <code>compat-table</code>, and <code>electron-to-chromium</code> 实现了特性的精细按需引入。</p></li></ul> <h5 id="compat-table-这个库维护着每个特性在不同环境的支持情况"><a href="#compat-table-这个库维护着每个特性在不同环境的支持情况" class="header-anchor">#</a> compat-table  这个库维护着每个特性在不同环境的支持情况</h5> <h3 id="plugin-插件的选择"><a href="#plugin-插件的选择" class="header-anchor">#</a> plugin 插件的选择</h3> <p>虽然 Babel7 官方有 90 多个插件，不过大半已经整合在@babel/preset-env 和@babel/preset-react 等预设里了，我们在开发的时候直接使用预设就可以了。</p> <p>目前比较常用的插件只有@babel/plugin-transform-runtime。</p> <p>1.自动移除语法转换后内联的辅助函数</p> <p>2.当代码里使用了 core-js 的 API，自动引入@babel/runtime-corejs3/core-js-stable/，以此来替代全局引入的 core-js/stable;</p> <p>3.当代码里使用了 Generator/async 函数，自动引入@babel/runtime/regenerator，以此来替代全局引入的 regenerator-runtime/runtime</p> <p><code>作用2和3其实是在做API转换，对内置对象进行重命名，以防止污染全局环境。</code></p> <p>引入'babel-polyfill'或'core-js/stable 与 regenerator-runtime/runtime'来做全局的 API 补齐。但这样可能有一个问题，那就是对运行环境产生了污染。例如 Promise，我们的 polyfill 是<code>对浏览器的全局对象进行了重新赋值，我们重写了Promise及其原型链</code>,会对浏览器环境产生污染（即修改了浏览器的 window.Promise）。</p> <p>例子</p> <p>Babel 转换前的代码</p> <div class="language- extra-class"><pre><code>var obj = Promise.resolve();
</code></pre></div><p>若使用了'babel-polyfill'或'core-js/stable 与 regenerator-runtime/runtime'来做全局的 API 补齐，那么 Babel 转换后的代码仍然是</p> <div class="language- extra-class"><pre><code>var obj = Promise.resolve();
</code></pre></div><p>polyfill 只是补齐了浏览器的 window.Promise 对象。</p> <p>若我们不使用 polyfill，而开启@babel/plugin-transform-runtime 的 API 转换功能。那么 Babel 转换后的代码将是</p> <div class="language- extra-class"><pre><code>var _interopRequireDefault = require(&quot;@babel/runtime-corejs3/helpers/interopRequireDefault&quot;);
var _promise = _interopRequireDefault(require(&quot;@babel/runtime-corejs3/core-js-stable/promise&quot;));
var obj = _promise[&quot;default&quot;].resolve();
</code></pre></div><p>@babel/plugin-transform-runtime 把我们代码里的 Promise 变成了_promise[&quot;default&quot;]，而_promise[&quot;default&quot;]拥有 ES 标准里 Promise 所有的功能。现在，即使浏览器没有 Promise，我们的代码也能正常运行。</p> <p><code>API转换有什么用，明明通过polyfill补齐API的方式也可以使代码在浏览器正常运行？</code></p> <p>API 转换主要是给开发 JS 库或 npm 包等的人用的，我们的前端工程一般仍然使用 polyfill 补齐 API。</p> <p><code>@babel/runtime包提供辅助函数模块,他的的进化版@babel/runtime-corejs3</code></p> <p>如果我们使用@babel/plugin-transform-runtime 来做 polyfill 的事情，那么就不要再使用之前讲过的 polyfill 方式了，无论是单独引入还是@babel/preset-env 的方式。因为我们用 transform-runtime 来做 api 转换的目的是不污染全局作用域。</p> <p>默认值</p> <div class="language- extra-class"><pre><code>{
    &quot;plugins&quot;: [
        [
            &quot;@babel/plugin-transform-runtime&quot;,
            {
                &quot;helpers&quot;: true, 否要自动引入辅助函数包
                &quot;corejs&quot;: false, corejs取值是false、2和3 开发JS库的时候设为2和3
                &quot;regenerator&quot;: true, corejs和regenerator 两项 是否做API转换以避免污染全局环境
                &quot;useESModules&quot;: false, 是否使用ES6的模块化用法,在用webpack一类的打包工具的时候，可以设置为true，以便做静态分析
                &quot;absoluteRuntime&quot;: false,
                &quot;version&quot;: &quot;7.0.0-beta.0&quot;
            }
        ]
    ]
}
</code></pre></div><p>PS:每个转换后的文件上部都会注入这些相同的函数声明，那为何不用 webpack 一类的打包工具去掉重复的函数声明，而是要单独再引一个辅助函数包？</p> <p>webpack 在构建的时候，是基于模块来做去重工作的。每一个函数声明都是引用类型，在堆内存不同的空间存放，缺少唯一的地址来找到他们。所以 webpack 本身是做不到把每个文件的相同函数声明去重的。因此我们需要单独的辅助函数包，这样 webpack 打包的时候会基于模块来做去重工作。</p> <h4 id="babel-共有3种插件"><a href="#babel-共有3种插件" class="header-anchor">#</a> babel 共有3种插件：</h4> <p>1.<code>babel-plugin-transform-xx</code>：转换插件，主要用来加强转换能力；</p> <p>2.<code>babel-plugin-syntax-xx</code>：语法插件，主要是扩展编译能力，比如不在 async 函数作用域里面使用 await，如果不引入<code>@babel/plugin-syntax-top-level-await</code>，是没办法编译成 AST 树的。并且会报 Unexpected reserved word 'await' 这种类似的错误。</p> <p>3.<code>babel-plugin-proposal-xx</code>：用来编译和转换在提案中的属性，在 Plugins List 中可以看到这些插件，比如 <code>class-properties</code>、<code>decorators</code>。</p> <h3 id="babel-polyfill"><a href="#babel-polyfill" class="header-anchor">#</a> @babel/polyfill</h3> <p>Babel 官方的 polyfill 使用方法主要有如下几种</p> <p>1.直接在 html 文件引入 Babel 官方的 polyfill.js 脚本文件；</p> <p>2.在前端工程的入口文件里引入 polyfill.js；</p> <p>3.在前端工程的入口文件里引入@babel/polyfill；</p> <p>4.在前端工程的入口文件里引入 core-js/stable 与 regenerator-runtime/runtime；</p> <p>5.在前端工程构建工具的配置文件入口项引入 polyfill.js；</p> <p>6.在前端工程构建工具的配置文件入口项引入@babel/polyfill；</p> <p>7.在前端工程构建工具的配置文件入口项引入 core-js/stable 与 regenerator-runtime/runtime；</p> <p>从 babel7.4 开始，官方不推荐再使用@babel/polyfill 了，因为@babel/polyfill 本身其实就是两个 npm 包的集合：core-js 与 regenerator-runtime。</p> <p>官方推荐直接使用这两个 npm 包。虽然@babel/polyfill 还在进行版本升级，但其使用的 core-js 包为 2.x.x 版本，而 core-js 这个包本身已经发布到了 3.x.x 版本了，@babel/polyfill 以后也不会使用 3.x.x 版本的包了。新版本的 core-js 实现了许多新的功能，例如数组的 includes 方法,所以现在直接配置@babel/preset-env，useBuiltIns usage</p> <p>目前前端需要的配置</p> <div class="language- extra-class"><pre><code>{
    &quot;presets&quot;: [
        [
            &quot;@babel/preset-env&quot;,
            {
                // 描述您为项目支持/目标的环境
                &quot;targets&quot;: {
                    &quot;browsers&quot;: [&quot;&gt; 1%&quot;, &quot;last 2 versions&quot;]
                },
                &quot;corejs&quot;: 3, //新版本需要指定核⼼库版本
                &quot;useBuiltIns&quot;: &quot;usage&quot;, //按需注⼊
                &quot;modules&quot;: false
            }
        ]
    ],
    &quot;plugins&quot;:[
        &quot;@babel/transform-runtime&quot;
    ]
}
</code></pre></div><p>如果写个插件 参考<code>不可多得的 Babel 小抄</code></p> <p>参考：</p> <p><a href="https://mp.weixin.qq.com/s/lVd-kXDUH7kSwkYQEvQO4Q" target="_blank" rel="noopener noreferrer">不可多得的 Babel 小抄<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jiangruitao.com/babel/babel-node/" target="_blank" rel="noopener noreferrer">babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/5d396b/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">前端应该掌握的命令行</div></a> <a href="/pages/f05617/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Babel原理</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/5d396b/" class="prev">前端应该掌握的命令行</a></span> <span class="next"><a href="/pages/f05617/">Babel原理</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:924064382@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/erdang" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2023
    <span>Er Dang | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;width:160px;height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c3eaab60.js" defer></script><script src="/assets/js/2.0d541d74.js" defer></script><script src="/assets/js/11.fdd192f9.js" defer></script>
  </body>
</html>