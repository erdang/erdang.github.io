---
title: 一篇git扫盲
date: 2021-09-29 13:59:38
permalink: /pages/52d5c3
article: false
---

版本管理在产品级开发中是非常重要的一个部分，它涉及到团队协作，且影响到产品最终的发布、上线以及测试环节，当前最流行的版本控制系统是 git。git 内容非常多，本文只讲基础和平时工作中常用的命令。

## git 优势

1、分布式版本管理系统

2、速度快

3、设计简单

4、轻量级的分支操作，允许上千个并行开发的分支，对非线性开发模式的强力支持

5、有能力高效管理类似 linux 内核一样的超大规模项目

6、git 已经成为事实上的标准，几乎所有优秀的前端项目都通过 git 来进行版本控制

7、社区成熟活跃，git 的流行离不开 github 的贡献

## git 配置

    取消全局配置    git config --global --unset user.name
    设置全局用户名  git config --global user.name "erdang"
    设置全局邮箱    git config --global user.email "924064382@qq.com"
    查看所有配置    git config --list
    查看全局配置    git config --list --global
    --global 可选 以下  设置本仓库 --global 删除
    --local【默认，高优先级】：只影响本仓库，文件为.git/config
    --global【中优先级】：影响到所有当前用户的git仓库，文件为~/.gitconfig
    --system【低优先级】：影响到全系统的git仓库，文件为/etc/gitconfig
    如果要删除或修改配置，更简单的办法是直接打开~/.gitconfig文件，或者.git/config文件修改即可

### 关于忽略的配置

可以在项目根目录创建一个名为 .gitignore 的文件，列出要忽略的文件模式
文件 .gitignore 的格式规范如下：

1、所有空行或者以注释符号 ＃ 开头的行都会被 git 忽略

2、可以使用标准的 glob 模式匹配

3、匹配模式以反斜杠(/)开头防止递归

4、匹配模式最后跟反斜杠(/)说明要忽略的是目录

5、要忽略指定模式以外的文件或目录，可以在模式前加上叹号(!)取反

    node_modules/
    ecosystem.json
    .DS_Store
    .idea
    .vscode

### SSH 配置

    cd ~/.ssh
    ssh-keygen -t rsa -C "your_email@youremail.com"  一路回车
    cat id_rsa.pub
    登陆 gitHub，打开 Settings 中的 SSH Keys 页面
    ssh -T git@github.com 测试成功
    Hi littlematch0123! You've successfully authenticated, but GitHub does not provide shell access.
    .ssh 目录，里面有 id_rsa 和 id_rsa.pub 两个文件，这两个就是 SSH Key 的秘钥对，
    id_rsa 是私钥，不能泄露出去，id_rsa.pub 是公钥，可以放心地告诉任何人

    如果配置 多用户 config  生成新的ssh 之后 需要  ssh-add id_rsa  添加生效
    #github user
    Host git@github.com
    Hostname https://github.com/
    User 924064382@qq.com
    IdentityFile ~/.ssh/id_rsa

    #gitlab user
    Host  172.16.27.229:8888
    Hostname http://172.16.27.229:8888/
    User git
    IdentityFile ~/.ssh/id_rsa_1

## 重要概念

### 【常用术语】

    repository 仓库
    branch 分支
    summary 概要
    track 跟踪
    modify 修改
    stage 暂存区
    stash 暂存
    commit 提交
    push 推送
    pull 拉取加合并
    fetch 拉取
    clone 克隆
    amend 修改
    merge 合并
    conflict 冲突
    origin 起源
    upstream 上游
    downstream 下游
    verbose 冗长的
    reflog 回流
    rebase 变基

### 【.git 目录】

每个项目都有一个 git 目录(如果 git clone 出来的话，就是其中.git 的目录)，它是 git 用来保存元数据和对象数据库的地方。这个目录非常重要，每次克隆镜像仓库的时候，实际拷贝的就是这个目录里面的数据

- 工作区：就是你在电脑里能看到的目录。
- 暂存区：英文叫 stage 或 index。一般存放在 .git 目录下的 index 文件（.git/index）中，所以我们把暂存区有时也叫作索引（index）。
  (索引文件里面包含的是文件的目录树，像一个虚拟的工作区，在这个虚拟工作区的目录树中，记录了文件名、文件的最后修改时间、文件长度、文件类型以及最重要的 SHA-1 值，文件的内容并没有存储在其中。而这个 SHA-1 值就是某个文件的当前版本号。而文件的具体内容是在.git/objects 目录下，你会发现这个目录占用空间比较大，因为它存储着当前项目文件各个版本的内容。)

- 版本库：工作区有一个隐藏目录 .git，这个不算工作区，而是 Git 的版本库。

### 【HEAD 是啥？】

用 HEAD 来表示当前版本，也就是最新的提交，上一个版本就是 HEAD^，上上一个版本就是 HEAD^^，当然往上 100 个版本写 100 个^比较容易数不过来，所以写成 HEAD~100

假设，我们现在关闭 git bash 和工作目录，当我们下次再次进入工作目录并且打开 git bash 时，仍然会显示为当前处于 master 分支，
因为我们上次关闭工作目录之前，已经切换到了 master 分支，当然，如果你之前处于 test 分支，那么当你再次打开工作空间，
仍然会显示你处于 test 分支。
</br>
git 其实就是靠 HEAD 知道我们该处于哪个分支的,HEAD 理解成一个指针
</br>
通常情况下 HEAD 指针指向我们所在的分支（的分支指针)，间接的指向了当前分支的最新提交
</br>
.git/HEAD
</br>
.git/refs/heads

特殊情况下 分离头 HEAD 指针没有指向分支指针，而是直接指向了某个提交 （直接检出一个提交 git checkout 哈希）
</br>
git log --oneline --all --graph 命令行中以字符的形式尽量接近图形化的方式展示分支
分离头的状态就是让我们可以随意的检出某个提交，然后基于这个提交创建一些新提交

git reflog 中记录的就是各种指针的常见操作，对分支指针、HEAD 指针等各种” 指针”（即”引用”）的常见操作都会记录
[HEAD 详细介绍](https://www.zsythink.net/archives/3412/)

## 【git 基础操作】

### git clone

克隆仓库的命令格式为

    git clone repo

如果我们需要克隆到指定的目录，可以使用以下命令格式

    git clone <repo> <directory>

### git init

要对现有的某个项目开始用 git 管理，只需到此项目所在的目录，执行

    git init

### git add

`git add` 命令是个多功能命令，根据目标文件的状态不同，此命令的效果也不同：</br>
可以用它开始跟踪新文件，或者把已跟踪的文件放到暂存区，还能用于合并时把有冲突的文件标记为已解决状态等

    git add text 添加单个到下一次提交中
    git add . 添加当前目录下所有文件到下一次提交中

### git commit

    git commit -m '更新 README 内容'
    git commit -am '更新 README'  加上 -a 选项，git 会自动把所有已经跟踪过的文件暂存起来一并提交
    git commit -amend 修改最后一个提交 不会产生新的提交记录
    git commit -v
    使用 -v 或--verbose选项，翻译成中文是冗余的，它不仅能回顾刚刚修改的内容，而且会迫使把提交理由写得更详细些

### git log 与 git reflog

    git log 可以查看提交历史
    git log --oneline 将每个提交放在一行显示，这在提交数很大时非常有用
    git log -p -2  -p 选项展开显示每次提交的内容差异，用 -2 则仅显示最近的两次更新
    git reflog 用来记录每一次命令 各种指针的常见操作
    git blame <file> 以列表形式显示修改记录指定文件

### git diff 查看不同

    git diff 工作目录中当前文件和暂存区域快照之间的差异
    git diff --cached  看已经暂存起来的文件和上次提交时的快照之间的差异

### git status 查看状态

要确定哪些文件当前处于什么状态，可以用 `git status`命令</br>
`git status`命令的输出十分详细，但其用语有些繁琐。</br>
如果使用 `git status -s` 命令或 `git status --short` 命令，将得到一种更为紧凑的格式输出</br>
一般地，-s 选项与-b 选项同时使用，s 代表 summary(概要)，b 代表 branch(分支)

### git reset

git reset 命令用于回退版本，可以指定退回某一次提交的版本。

    git reset [--soft | --mixed | --hard][HEAD]
    --soft 工作区和暂存区 不会改变
    --hard 工作区和暂存区 都会改变
    --mixed 暂存区改变 工作区不变 默认值
    git reset HEAD 取消git add 添加

### 分支 git branch 和 git checkout

git 中默认分支的名字是`master`，而`origin`是 Git 给克隆的仓库服务器的默认名字。

    git checkout test 创建分支
    git checkout test -b 创建分支并切换到当前分支
    git checkout <remotebranch> origin/<remotebranch> 检出远程分支
    git checkout -b new test/acc 检出远程 test仓库下 acc分支到本地
    git checkout --文件 丢弃文件工作区的修改
    git branch test -d 删除分支
    git branch test -D 强制删除分支
    git branch 显示当前所有分支的一个列表
    git branch -v 可以查看每一个分支的最后一次提交
    git branch --merged 可以看到已经合并到当前分支的分支列表

### 合并分支 (解决冲突)

    当Git无法自动合并分支时，就必须首先解决冲突。解决冲突后，再提交，合并完成。
    手动解决完 git add .  提交
    git merge --abort 退出合并

### git rebase

    git rebase [branch] 把分叉的提交变成直线。
    git log  查看提交记录 然后 找到版本号
    git reabse -i 哈希 合并提交记录
    按i 进入编辑模式   不需要的 改成s
    pick：保留该commit（缩写:p）
    reword：保留该 commit，但我需要修改该 commit 的注释（缩写:r）
    edit：保留该 commit, 但我要停下来修改该提交(不仅仅修改注释)（缩写:e）
    squash：将该 commit 和前一个 commit 合并（缩写:s）

### git fetch 与 git pull

     git fetch origin master:brantest 命令用于从远程获取代码库
     git fetch 简写
     git fetch -p 命令 删除不存在的远程分支
     git merge [branch] 合并
     git pull == git fetch 加 git merge
     git pull <远程主机名> <远程分支名>:<本地分支名>
     git pull origin master:brantest
     将远程主机 origin 的 master 分支拉取过来，与本地的 brantest 分支合并。
     git pull origin master 与当前分支合并

### git push

    git push <远程主机名> <本地分支名>:<远程分支名>
    git push --force origin master:master --force强制
    git push origin --delete master 删除分支

### git remote 命令

    git remote -v 显示所有远程仓库
    origin 为远程地址的别名
    git remote show [remote]  显示某个远程仓库的信息
    git remote add [shortname] [url] 添加远程版本库： shortname 为本地的版本库，
    git remote add origin git@github.com:tianqixin/runoob-git-test.git
    git push -u origin master
    git remote rm name  # 删除远程仓库
    git remote rename old_name new_name  # 修改仓库名
    git push --set-upstream origin branch_name
    在远程创建一个与本地branch_name 分支同名的分支并跟踪；
    git checkout --track origin/branch_name
    来在本地创建一个与 branch_name 同名分支跟踪远程分支
   

### 删除

    git rm text 删除文件
    git rm -f text 强制删除  -force 强制
    git rm -rf text 强制删除文件夹 -r 递归
    git rm --cached text  删除缓存 不被跟踪
